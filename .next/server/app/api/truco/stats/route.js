"use strict";(()=>{var e={};e.id=752,e.ids=[752],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1652:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>R,requestAsyncStorage:()=>E,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{GET:()=>p});var o=t(9303),n=t(8716),s=t(670),i=t(7070),u=t(8990),c=t(6801),l=t(7046);async function p(e){try{await (0,l.uD)();let{searchParams:r}=new URL(e.url),t=r.get("playerId");if(!t)return i.NextResponse.json({success:!1,error:"Player ID \xe9 obrigat\xf3rio"},{status:400});let a=await (0,u.GA)(parseInt(t));if(!a)return i.NextResponse.json({success:!1,error:"Usu\xe1rio n\xe3o encontrado"},{status:404});let o=await (0,u.ve)(a.id,100),n=o.filter(e=>"bet_win"===e.type||"bet_loss"===e.type).map(e=>({playerWin:"bet_win"===e.type,betAmount:Math.abs(e.amount),createdAt:e.created_at})),s=(0,c.xj)(n),{password_hash:p,...d}=a;return i.NextResponse.json({success:!0,data:{user:d,stats:s,recentGames:n.slice(0,10),transactions:o.slice(0,20)}})}catch(e){return console.error("Erro ao buscar estat\xedsticas:",e),i.NextResponse.json({success:!1,error:"Erro interno do servidor"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/truco/stats/route",pathname:"/api/truco/stats",filename:"route",bundlePath:"app/api/truco/stats/route"},resolvedPagePath:"/workspaces/truco-online/src/app/api/truco/stats/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:E,staticGenerationAsyncStorage:m,serverHooks:y}=d,w="/api/truco/stats/route";function R(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},8990:(e,r,t)=>{t.d(r,{A4:()=>c,CX:()=>n,GA:()=>s,Ls:()=>p,_X:()=>E,dB:()=>u,k1:()=>d,r4:()=>o,ve:()=>m,wW:()=>l,yi:()=>i});var a=t(7046);let o=async(e,r,t)=>(await (0,a.IO)("INSERT INTO users (email, username, password_hash) VALUES ($1, $2, $3) RETURNING *",[e,r,t])).rows[0],n=async e=>(await (0,a.IO)("SELECT * FROM users WHERE email = $1",[e])).rows[0],s=async e=>(await (0,a.IO)("SELECT * FROM users WHERE id = $1",[e])).rows[0],i=async(e,r)=>(await (0,a.IO)("UPDATE users SET balance = $1 WHERE id = $2 RETURNING *",[r,e])).rows[0],u=async(e,r,t,o=!1)=>{let n=o?Math.random().toString(36).substring(2,8).toUpperCase():null;return(await (0,a.IO)("INSERT INTO rooms (name, creator_id, bet_amount, is_private, room_code) VALUES ($1, $2, $3, $4, $5) RETURNING *",[e,r,t,o,n])).rows[0]},c=async(e=20)=>(await (0,a.IO)("SELECT r.*, u.username as creator_username FROM rooms r JOIN users u ON r.creator_id = u.id WHERE r.status = $1 ORDER BY r.created_at DESC LIMIT $2",["waiting",e])).rows,l=async e=>(await (0,a.IO)("SELECT * FROM rooms WHERE id = $1",[e])).rows[0],p=async(e,r)=>{let t=await l(e);if(!t||t.current_players>=t.max_players)throw Error("Sala n\xe3o encontrada ou lotada");return await (0,a.IO)("INSERT INTO room_participants (room_id, user_id, position) VALUES ($1, $2, $3)",[e,r,t.current_players+1]),await (0,a.IO)("UPDATE rooms SET current_players = current_players + 1 WHERE id = $1",[e]),!0},d=async e=>(await (0,a.IO)("SELECT rp.*, u.username FROM room_participants rp JOIN users u ON rp.user_id = u.id WHERE rp.room_id = $1 ORDER BY rp.position",[e])).rows,E=async(e,r,t,o,n)=>(await (0,a.IO)("INSERT INTO transactions (user_id, type, amount, description, mercadopago_payment_id) VALUES ($1, $2, $3, $4, $5) RETURNING *",[e,r,t,o||null,n||null])).rows[0],m=async(e,r=50)=>(await (0,a.IO)("SELECT * FROM transactions WHERE user_id = $1 ORDER BY created_at DESC LIMIT $2",[e,r])).rows},7046:(e,r,t)=>{t.d(r,{IO:()=>s,uD:()=>n}),function(){var e=Error("Cannot find module 'pg'");throw e.code="MODULE_NOT_FOUND",e}();let a=process.env.DATABASE_URL;if(!a)throw Error("‚ùå DATABASE_URL n\xe3o foi definido no arquivo .env.local");let o=Object(function(){var e=Error("Cannot find module 'pg'");throw e.code="MODULE_NOT_FOUND",e}())({connectionString:a,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3}),n=async()=>{try{let e=await o.connect();return console.log("‚úÖ PostgreSQL conectado com sucesso!"),e.release(),o}catch(e){throw console.error("‚ùå Erro ao conectar ao PostgreSQL:",e),e}},s=async(e,r)=>{try{return await o.query(e,r)}catch(e){throw console.error("‚ùå Erro ao executar query:",e),e}}},6801:(e,r,t)=>{t.d(r,{J9:()=>o,xj:()=>i});let a=["4‚ô†Ô∏è","4‚ô•Ô∏è","4‚ô¶Ô∏è","4‚ô£Ô∏è","5‚ô†Ô∏è","5‚ô•Ô∏è","5‚ô¶Ô∏è","5‚ô£Ô∏è","6‚ô†Ô∏è","6‚ô•Ô∏è","6‚ô¶Ô∏è","6‚ô£Ô∏è","7‚ô†Ô∏è","7‚ô•Ô∏è","7‚ô¶Ô∏è","7‚ô£Ô∏è","Q‚ô†Ô∏è","Q‚ô•Ô∏è","Q‚ô¶Ô∏è","Q‚ô£Ô∏è","J‚ô†Ô∏è","J‚ô•Ô∏è","J‚ô¶Ô∏è","J‚ô£Ô∏è","K‚ô†Ô∏è","K‚ô•Ô∏è","K‚ô¶Ô∏è","K‚ô£Ô∏è","A‚ô†Ô∏è","A‚ô•Ô∏è","A‚ô¶Ô∏è","A‚ô£Ô∏è","2‚ô†Ô∏è","2‚ô•Ô∏è","2‚ô¶Ô∏è","2‚ô£Ô∏è","3‚ô†Ô∏è","3‚ô•Ô∏è","3‚ô¶Ô∏è","3‚ô£Ô∏è"];function o(e,r){try{let e=.004>=Math.random(),t=n(3),a=n(3),o=[],i=0,u=0;for(let r=0;r<3;r++){let n;let c=t[r],l=a[r],p=s(c),d=s(l);n=e&&2===r&&i===u?"player":!e&&2===r&&i>u?"opponent":p>d?"player":"opponent","player"===n?i++:u++,o.push({roundNumber:r+1,playerCard:c,opponentCard:l,winner:n,cardValues:{playerValue:p,opponentValue:d}})}let c=i>u,l=e?c:!c,p=l?`üéâ Voc\xea ganhou! Parab\xe9ns! Voc\xea ganhou R$ ${(1.8*r).toFixed(2)}`:`üò¢ Voc\xea perdeu! O oponente foi melhor desta vez. Voc\xea perdeu R$ ${r.toFixed(2)}`;return{playerWin:l,message:p,cards:[...t,...a],playerCards:t,opponentCards:a,gameDetails:{playerScore:l?Math.max(i,2):Math.min(i,1),opponentScore:l?Math.min(u,1):Math.max(u,2),rounds:o}}}catch(e){return console.error("Erro na fun\xe7\xe3o playTrucoGame:",e),{playerWin:!1,message:"\uD83D\uDE22 Voc\xea perdeu! Tente novamente.",cards:["7‚ô†Ô∏è","Q‚ô•Ô∏è","A‚ô¶Ô∏è","4‚ô£Ô∏è","K‚ô†Ô∏è","2‚ô•Ô∏è"],playerCards:["7‚ô†Ô∏è","Q‚ô•Ô∏è","A‚ô¶Ô∏è"],opponentCards:["4‚ô£Ô∏è","K‚ô†Ô∏è","2‚ô•Ô∏è"],gameDetails:{playerScore:1,opponentScore:2,rounds:[{roundNumber:1,playerCard:"7‚ô†Ô∏è",opponentCard:"4‚ô£Ô∏è",winner:"player",cardValues:{playerValue:3,opponentValue:0}},{roundNumber:2,playerCard:"Q‚ô•Ô∏è",opponentCard:"K‚ô†Ô∏è",winner:"opponent",cardValues:{playerValue:4,opponentValue:6}},{roundNumber:3,playerCard:"A‚ô¶Ô∏è",opponentCard:"2‚ô•Ô∏è",winner:"opponent",cardValues:{playerValue:7,opponentValue:8}}]}}}}function n(e){try{let r=["‚ô†Ô∏è","‚ô•Ô∏è","‚ô¶Ô∏è","‚ô£Ô∏è"],t=["4","5","6","7","Q","J","K","A","2","3"],a=[];for(let o=0;o<e;o++){let e=t[Math.floor(Math.random()*t.length)],o=r[Math.floor(Math.random()*r.length)];a.push(`${e}${o}`)}return a}catch(e){return console.error("Erro ao gerar cartas:",e),["7‚ô†Ô∏è","Q‚ô•Ô∏è","A‚ô¶Ô∏è"]}}function s(e){try{let r=a.indexOf(e);return r>=0?r:0}catch(e){return console.error("Erro ao obter valor da carta:",e),0}}function i(e){try{let r=e.length,t=e.filter(e=>e.playerWin).length,a=e.reduce((e,r)=>e+r.betAmount,0),o=e.filter(e=>e.playerWin).reduce((e,r)=>e+1.8*r.betAmount,0),n=e.filter(e=>!e.playerWin).reduce((e,r)=>e+r.betAmount,0);return{totalGames:r,wins:t,losses:r-t,winRate:r>0?t/r*100:0,totalBet:a,totalWinnings:o,totalLosses:n,netProfit:o-n}}catch(e){return console.error("Erro ao calcular estat\xedsticas:",e),{totalGames:0,wins:0,losses:0,winRate:0,totalBet:0,totalWinnings:0,totalLosses:0,netProfit:0}}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,972],()=>t(1652));module.exports=a})();