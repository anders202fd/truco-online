"use strict";(()=>{var r={};r.id=2,r.ids=[2],r.modules={399:r=>{r.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3036:(r,e,t)=>{t.r(e),t.d(e,{originalPathname:()=>m,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>E,serverHooks:()=>O,staticGenerationAsyncStorage:()=>l});var o={};t.r(o),t.d(o,{POST:()=>d});var a=t(9303),s=t(8716),n=t(670),i=t(7070),u=t(7046),c=t(8990);async function d(r){try{await (0,u.uD)();let{email:e,username:t,password:o}=await r.json();if(!e||!t||!o)return i.NextResponse.json({success:!1,error:"Todos os campos s\xe3o obrigat\xf3rios"},{status:400});if(o.length<6)return i.NextResponse.json({success:!1,error:"Senha deve ter pelo menos 6 caracteres"},{status:400});if(await (0,c.CX)(e))return i.NextResponse.json({success:!1,error:"Email j\xe1 est\xe1 em uso"},{status:400});let a=await Object(function(){var r=Error("Cannot find module 'bcryptjs'");throw r.code="MODULE_NOT_FOUND",r}())(o,12),{password_hash:s,...n}=await (0,c.r4)(e,t,a);return i.NextResponse.json({success:!0,data:n},{status:201})}catch(r){return console.error("Erro ao criar usu\xe1rio:",r),i.NextResponse.json({success:!1,error:"Erro interno do servidor"},{status:500})}}!function(){var r=Error("Cannot find module 'bcryptjs'");throw r.code="MODULE_NOT_FOUND",r}();let E=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/workspaces/truco-online/src/app/api/auth/register/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:l,serverHooks:O}=E,m="/api/auth/register/route";function w(){return(0,n.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:l})}},8990:(r,e,t)=>{t.d(e,{A4:()=>c,CX:()=>s,GA:()=>n,Ls:()=>E,_X:()=>l,dB:()=>u,k1:()=>p,r4:()=>a,ve:()=>O,wW:()=>d,yi:()=>i});var o=t(7046);let a=async(r,e,t)=>(await (0,o.IO)("INSERT INTO users (email, username, password_hash) VALUES ($1, $2, $3) RETURNING *",[r,e,t])).rows[0],s=async r=>(await (0,o.IO)("SELECT * FROM users WHERE email = $1",[r])).rows[0],n=async r=>(await (0,o.IO)("SELECT * FROM users WHERE id = $1",[r])).rows[0],i=async(r,e)=>(await (0,o.IO)("UPDATE users SET balance = $1 WHERE id = $2 RETURNING *",[e,r])).rows[0],u=async(r,e,t,a=!1)=>{let s=a?Math.random().toString(36).substring(2,8).toUpperCase():null;return(await (0,o.IO)("INSERT INTO rooms (name, creator_id, bet_amount, is_private, room_code) VALUES ($1, $2, $3, $4, $5) RETURNING *",[r,e,t,a,s])).rows[0]},c=async(r=20)=>(await (0,o.IO)("SELECT r.*, u.username as creator_username FROM rooms r JOIN users u ON r.creator_id = u.id WHERE r.status = $1 ORDER BY r.created_at DESC LIMIT $2",["waiting",r])).rows,d=async r=>(await (0,o.IO)("SELECT * FROM rooms WHERE id = $1",[r])).rows[0],E=async(r,e)=>{let t=await d(r);if(!t||t.current_players>=t.max_players)throw Error("Sala n\xe3o encontrada ou lotada");return await (0,o.IO)("INSERT INTO room_participants (room_id, user_id, position) VALUES ($1, $2, $3)",[r,e,t.current_players+1]),await (0,o.IO)("UPDATE rooms SET current_players = current_players + 1 WHERE id = $1",[r]),!0},p=async r=>(await (0,o.IO)("SELECT rp.*, u.username FROM room_participants rp JOIN users u ON rp.user_id = u.id WHERE rp.room_id = $1 ORDER BY rp.position",[r])).rows,l=async(r,e,t,a,s)=>(await (0,o.IO)("INSERT INTO transactions (user_id, type, amount, description, mercadopago_payment_id) VALUES ($1, $2, $3, $4, $5) RETURNING *",[r,e,t,a||null,s||null])).rows[0],O=async(r,e=50)=>(await (0,o.IO)("SELECT * FROM transactions WHERE user_id = $1 ORDER BY created_at DESC LIMIT $2",[r,e])).rows},7046:(r,e,t)=>{t.d(e,{IO:()=>n,uD:()=>s}),function(){var r=Error("Cannot find module 'pg'");throw r.code="MODULE_NOT_FOUND",r}();let o=process.env.DATABASE_URL;if(!o)throw Error("❌ DATABASE_URL n\xe3o foi definido no arquivo .env.local");let a=Object(function(){var r=Error("Cannot find module 'pg'");throw r.code="MODULE_NOT_FOUND",r}())({connectionString:o,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3}),s=async()=>{try{let r=await a.connect();return console.log("✅ PostgreSQL conectado com sucesso!"),r.release(),a}catch(r){throw console.error("❌ Erro ao conectar ao PostgreSQL:",r),r}},n=async(r,e)=>{try{return await a.query(r,e)}catch(r){throw console.error("❌ Erro ao executar query:",r),r}}}};var e=require("../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),o=e.X(0,[948,972],()=>t(3036));module.exports=o})();