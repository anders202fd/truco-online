"use strict";(()=>{var r={};r.id=873,r.ids=[873],r.modules={399:r=>{r.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8669:(r,e,o)=>{o.r(e),o.d(e,{originalPathname:()=>w,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>E,serverHooks:()=>O,staticGenerationAsyncStorage:()=>p});var t={};o.r(t),o.d(t,{POST:()=>d});var a=o(9303),s=o(8716),n=o(670),i=o(7070),u=o(7046),c=o(8990);async function d(r){try{await (0,u.uD)();let{email:e,password:o}=await r.json();if(!e||!o)return i.NextResponse.json({success:!1,error:"Email e senha s\xe3o obrigat\xf3rios"},{status:400});let t=await (0,c.CX)(e);if(!t||!await Object(function(){var r=Error("Cannot find module 'bcryptjs'");throw r.code="MODULE_NOT_FOUND",r}())(o,t.password_hash))return i.NextResponse.json({success:!1,error:"Credenciais inv\xe1lidas"},{status:401});let a=Object(function(){var r=Error("Cannot find module 'jsonwebtoken'");throw r.code="MODULE_NOT_FOUND",r}())({userId:t.id,email:t.email},process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"}),{password_hash:s,...n}=t;return i.NextResponse.json({success:!0,data:{user:n,token:a}})}catch(r){return console.error("Erro ao fazer login:",r),i.NextResponse.json({success:!1,error:"Erro interno do servidor"},{status:500})}}(function(){var r=Error("Cannot find module 'bcryptjs'");throw r.code="MODULE_NOT_FOUND",r})(),function(){var r=Error("Cannot find module 'jsonwebtoken'");throw r.code="MODULE_NOT_FOUND",r}();let E=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/workspaces/truco-online/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:p,serverHooks:O}=E,w="/api/auth/login/route";function m(){return(0,n.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:p})}},8990:(r,e,o)=>{o.d(e,{A4:()=>c,CX:()=>s,GA:()=>n,Ls:()=>E,_X:()=>p,dB:()=>u,k1:()=>l,r4:()=>a,ve:()=>O,wW:()=>d,yi:()=>i});var t=o(7046);let a=async(r,e,o)=>(await (0,t.IO)("INSERT INTO users (email, username, password_hash) VALUES ($1, $2, $3) RETURNING *",[r,e,o])).rows[0],s=async r=>(await (0,t.IO)("SELECT * FROM users WHERE email = $1",[r])).rows[0],n=async r=>(await (0,t.IO)("SELECT * FROM users WHERE id = $1",[r])).rows[0],i=async(r,e)=>(await (0,t.IO)("UPDATE users SET balance = $1 WHERE id = $2 RETURNING *",[e,r])).rows[0],u=async(r,e,o,a=!1)=>{let s=a?Math.random().toString(36).substring(2,8).toUpperCase():null;return(await (0,t.IO)("INSERT INTO rooms (name, creator_id, bet_amount, is_private, room_code) VALUES ($1, $2, $3, $4, $5) RETURNING *",[r,e,o,a,s])).rows[0]},c=async(r=20)=>(await (0,t.IO)("SELECT r.*, u.username as creator_username FROM rooms r JOIN users u ON r.creator_id = u.id WHERE r.status = $1 ORDER BY r.created_at DESC LIMIT $2",["waiting",r])).rows,d=async r=>(await (0,t.IO)("SELECT * FROM rooms WHERE id = $1",[r])).rows[0],E=async(r,e)=>{let o=await d(r);if(!o||o.current_players>=o.max_players)throw Error("Sala n\xe3o encontrada ou lotada");return await (0,t.IO)("INSERT INTO room_participants (room_id, user_id, position) VALUES ($1, $2, $3)",[r,e,o.current_players+1]),await (0,t.IO)("UPDATE rooms SET current_players = current_players + 1 WHERE id = $1",[r]),!0},l=async r=>(await (0,t.IO)("SELECT rp.*, u.username FROM room_participants rp JOIN users u ON rp.user_id = u.id WHERE rp.room_id = $1 ORDER BY rp.position",[r])).rows,p=async(r,e,o,a,s)=>(await (0,t.IO)("INSERT INTO transactions (user_id, type, amount, description, mercadopago_payment_id) VALUES ($1, $2, $3, $4, $5) RETURNING *",[r,e,o,a||null,s||null])).rows[0],O=async(r,e=50)=>(await (0,t.IO)("SELECT * FROM transactions WHERE user_id = $1 ORDER BY created_at DESC LIMIT $2",[r,e])).rows},7046:(r,e,o)=>{o.d(e,{IO:()=>n,uD:()=>s}),function(){var r=Error("Cannot find module 'pg'");throw r.code="MODULE_NOT_FOUND",r}();let t=process.env.DATABASE_URL;if(!t)throw Error("❌ DATABASE_URL n\xe3o foi definido no arquivo .env.local");let a=Object(function(){var r=Error("Cannot find module 'pg'");throw r.code="MODULE_NOT_FOUND",r}())({connectionString:t,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3}),s=async()=>{try{let r=await a.connect();return console.log("✅ PostgreSQL conectado com sucesso!"),r.release(),a}catch(r){throw console.error("❌ Erro ao conectar ao PostgreSQL:",r),r}},n=async(r,e)=>{try{return await a.query(r,e)}catch(r){throw console.error("❌ Erro ao executar query:",r),r}}}};var e=require("../../../../webpack-runtime.js");e.C(r);var o=r=>e(e.s=r),t=e.X(0,[948,972],()=>o(8669));module.exports=t})();