"use strict";(()=>{var e={};e.id=148,e.ids=[148],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8164:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>h,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>O});var t={};o.r(t),o.d(t,{GET:()=>l,POST:()=>d});var n=o(9303),a=o(8716),s=o(670),i=o(7070),u=o(4184),c=o(3330);async function l(){try{let e=await Object(function(){var e=Error("Cannot find module 'next-auth'");throw e.code="MODULE_NOT_FOUND",e}())();if(!e?.user?.email)return i.NextResponse.json({error:"Unauthorized"},{status:401});await (0,u.u)();let r=await c.Z.findOne({email:e.user.email});if(!r)return i.NextResponse.json({error:"User not found"},{status:404});return i.NextResponse.json({balance:r.balance||0})}catch(e){return console.error("Error fetching balance:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e){try{let r=await Object(function(){var e=Error("Cannot find module 'next-auth'");throw e.code="MODULE_NOT_FOUND",e}())();if(!r?.user?.email)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{amount:o,type:t}=await e.json();if(!o||"number"!=typeof o)return i.NextResponse.json({error:"Invalid amount"},{status:400});await (0,u.u)();let n=await c.Z.findOne({email:r.user.email});if(!n)return i.NextResponse.json({error:"User not found"},{status:404});if("add"===t)n.balance=(n.balance||0)+o;else if("subtract"===t){if((n.balance||0)<o)return i.NextResponse.json({error:"Insufficient balance"},{status:400});n.balance=(n.balance||0)-o}return await n.save(),i.NextResponse.json({balance:n.balance})}catch(e){return console.error("Error updating balance:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}!function(){var e=Error("Cannot find module 'next-auth'");throw e.code="MODULE_NOT_FOUND",e}();let p=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/user/balance/route",pathname:"/api/user/balance",filename:"route",bundlePath:"app/api/user/balance/route"},resolvedPagePath:"/workspaces/truco-online/src/app/api/user/balance/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:O,serverHooks:m}=p,h="/api/user/balance/route";function b(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:O})}},4184:(e,r,o)=>{o.d(r,{u:()=>t.uD});var t=o(7046)},7046:(e,r,o)=>{o.d(r,{IO:()=>s,uD:()=>a}),function(){var e=Error("Cannot find module 'pg'");throw e.code="MODULE_NOT_FOUND",e}();let t=process.env.DATABASE_URL;if(!t)throw Error("❌ DATABASE_URL n\xe3o foi definido no arquivo .env.local");let n=Object(function(){var e=Error("Cannot find module 'pg'");throw e.code="MODULE_NOT_FOUND",e}())({connectionString:t,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3}),a=async()=>{try{let e=await n.connect();return console.log("✅ PostgreSQL conectado com sucesso!"),e.release(),n}catch(e){throw console.error("❌ Erro ao conectar ao PostgreSQL:",e),e}},s=async(e,r)=>{try{return await n.query(e,r)}catch(e){throw console.error("❌ Erro ao executar query:",e),e}}},3330:(e,r,o)=>{o.d(r,{Z:()=>n}),function(){var e=Error("Cannot find module 'mongoose'");throw e.code="MODULE_NOT_FOUND",e}();let t=Object(function(){var e=Error("Cannot find module 'mongoose'");throw e.code="MODULE_NOT_FOUND",e}())({name:{type:String,required:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!0},balance:{type:Number,default:0},history:[{type:Object(function(){var e=Error("Cannot find module 'mongoose'");throw e.code="MODULE_NOT_FOUND",e}()).Types.ObjectId,ref:"Game"}]},{timestamps:!0}),n=Object(function(){var e=Error("Cannot find module 'mongoose'");throw e.code="MODULE_NOT_FOUND",e}()).User||Object(function(){var e=Error("Cannot find module 'mongoose'");throw e.code="MODULE_NOT_FOUND",e}())("User",t)}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[948,972],()=>o(8164));module.exports=t})();