"use strict";(()=>{var r={};r.id=461,r.ids=[461],r.modules={399:r=>{r.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},611:(r,e,o)=>{o.r(e),o.d(e,{originalPathname:()=>R,patchFetch:()=>O,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m});var s={};o.r(s),o.d(s,{GET:()=>d,POST:()=>E});var a=o(9303),t=o(8716),n=o(670),i=o(7070),c=o(7046),u=o(8990);async function d(r,{params:e}){try{await (0,c.uD)();let r=parseInt(e.id);if(isNaN(r))return i.NextResponse.json({success:!1,error:"ID da sala inv\xe1lido"},{status:400});let o=await (0,u.wW)(r);if(!o)return i.NextResponse.json({success:!1,error:"Sala n\xe3o encontrada"},{status:404});let s=await (0,u.k1)(r);return i.NextResponse.json({success:!0,data:{...o,participants:s}})}catch(r){return console.error("Erro ao buscar sala:",r),i.NextResponse.json({success:!1,error:"Erro interno do servidor"},{status:500})}}async function E(r,{params:e}){try{await (0,c.uD)();let o=parseInt(e.id),{userId:s}=await r.json();if(isNaN(o)||!s)return i.NextResponse.json({success:!1,error:"Dados inv\xe1lidos"},{status:400});return await (0,u.Ls)(o,s),i.NextResponse.json({success:!0,message:"Entrou na sala com sucesso"})}catch(r){return console.error("Erro ao entrar na sala:",r),i.NextResponse.json({success:!1,error:r instanceof Error?r.message:"Erro interno do servidor"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/rooms/[id]/route",pathname:"/api/rooms/[id]",filename:"route",bundlePath:"app/api/rooms/[id]/route"},resolvedPagePath:"/workspaces/truco-online/src/app/api/rooms/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:w}=p,R="/api/rooms/[id]/route";function O(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},8990:(r,e,o)=>{o.d(e,{A4:()=>u,CX:()=>t,GA:()=>n,Ls:()=>E,_X:()=>l,dB:()=>c,k1:()=>p,r4:()=>a,ve:()=>m,wW:()=>d,yi:()=>i});var s=o(7046);let a=async(r,e,o)=>(await (0,s.IO)("INSERT INTO users (email, username, password_hash) VALUES ($1, $2, $3) RETURNING *",[r,e,o])).rows[0],t=async r=>(await (0,s.IO)("SELECT * FROM users WHERE email = $1",[r])).rows[0],n=async r=>(await (0,s.IO)("SELECT * FROM users WHERE id = $1",[r])).rows[0],i=async(r,e)=>(await (0,s.IO)("UPDATE users SET balance = $1 WHERE id = $2 RETURNING *",[e,r])).rows[0],c=async(r,e,o,a=!1)=>{let t=a?Math.random().toString(36).substring(2,8).toUpperCase():null;return(await (0,s.IO)("INSERT INTO rooms (name, creator_id, bet_amount, is_private, room_code) VALUES ($1, $2, $3, $4, $5) RETURNING *",[r,e,o,a,t])).rows[0]},u=async(r=20)=>(await (0,s.IO)("SELECT r.*, u.username as creator_username FROM rooms r JOIN users u ON r.creator_id = u.id WHERE r.status = $1 ORDER BY r.created_at DESC LIMIT $2",["waiting",r])).rows,d=async r=>(await (0,s.IO)("SELECT * FROM rooms WHERE id = $1",[r])).rows[0],E=async(r,e)=>{let o=await d(r);if(!o||o.current_players>=o.max_players)throw Error("Sala n\xe3o encontrada ou lotada");return await (0,s.IO)("INSERT INTO room_participants (room_id, user_id, position) VALUES ($1, $2, $3)",[r,e,o.current_players+1]),await (0,s.IO)("UPDATE rooms SET current_players = current_players + 1 WHERE id = $1",[r]),!0},p=async r=>(await (0,s.IO)("SELECT rp.*, u.username FROM room_participants rp JOIN users u ON rp.user_id = u.id WHERE rp.room_id = $1 ORDER BY rp.position",[r])).rows,l=async(r,e,o,a,t)=>(await (0,s.IO)("INSERT INTO transactions (user_id, type, amount, description, mercadopago_payment_id) VALUES ($1, $2, $3, $4, $5) RETURNING *",[r,e,o,a||null,t||null])).rows[0],m=async(r,e=50)=>(await (0,s.IO)("SELECT * FROM transactions WHERE user_id = $1 ORDER BY created_at DESC LIMIT $2",[r,e])).rows},7046:(r,e,o)=>{o.d(e,{IO:()=>n,uD:()=>t}),function(){var r=Error("Cannot find module 'pg'");throw r.code="MODULE_NOT_FOUND",r}();let s=process.env.DATABASE_URL;if(!s)throw Error("❌ DATABASE_URL n\xe3o foi definido no arquivo .env.local");let a=Object(function(){var r=Error("Cannot find module 'pg'");throw r.code="MODULE_NOT_FOUND",r}())({connectionString:s,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3}),t=async()=>{try{let r=await a.connect();return console.log("✅ PostgreSQL conectado com sucesso!"),r.release(),a}catch(r){throw console.error("❌ Erro ao conectar ao PostgreSQL:",r),r}},n=async(r,e)=>{try{return await a.query(r,e)}catch(r){throw console.error("❌ Erro ao executar query:",r),r}}}};var e=require("../../../../webpack-runtime.js");e.C(r);var o=r=>e(e.s=r),s=e.X(0,[948,972],()=>o(611));module.exports=s})();